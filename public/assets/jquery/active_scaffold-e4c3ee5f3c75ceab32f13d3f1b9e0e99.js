function addActiveScaffoldPageToHistory(e,t){if("undefined"!=typeof dhtmlHistory){var i=e.split("?"),a=new Querystring(i[1]),r=a.get("sort"),n=a.get("sort_direction"),o=a.get("page");(r||n||o)&&dhtmlHistory.add(t+":"+o+":"+r+":"+n,e)}}jQuery(document).ready(function(e){if("1.8.0">jQuery().jquery){var t="ActiveScaffold requires jquery 1.8.0 or greater, please use jquery-rails 2.1.x gem or greater";"undefined"!=typeof console?console.error(t):alert(t)}jQuery(document).on("focus",":input",function(){ActiveScaffold.last_focus=this}),jQuery(document).click(function(){jQuery(".action_group.dyn ul").remove()}),jQuery(document).on("ajax:complete",".action_group.dyn ul a",function(e){var t=ActiveScaffold.find_action_link(e.target);t.loading_indicator&&t.loading_indicator.css("visibility","hidden"),jQuery(e.target).closest(".action_group.dyn ul").remove()}),jQuery(document).on("ajax:beforeSend","form.as_form",function(){var e=jQuery(this).closest("form");return 1==e.data("loading")&&ActiveScaffold.disable_form(e),!0}),jQuery(document).on("ajax:complete","form.as_form",function(){var e=jQuery(this).closest("form");1==e.data("loading")&&ActiveScaffold.enable_form(e)}),jQuery(document).on("ajax:error","form.as_form",function(e,t){var i=jQuery(this).closest("div.active-scaffold");i.length&&ActiveScaffold.report_500_response(i,t)}),jQuery(document).on("submit","form.as_form:not([data-remote])",function(){var e=jQuery(this).closest("form");return 1==e.data("loading")&&setTimeout("ActiveScaffold.disable_form('"+e.attr("id")+"')",10),!0}),jQuery(document).on("ajax:before","a.as_action",function(){var e=ActiveScaffold.ActionLink.get(jQuery(this));if(e){if(e.is_disabled())return!1;e.loading_indicator&&e.loading_indicator.css("visibility","visible"),e.disable()}return!0}),jQuery(document).on("ajax:success","a.as_action",function(e,t){var i=ActiveScaffold.ActionLink.get(jQuery(this));return i&&(i.position?(i.insert(t),i.hide_target&&i.target.hide()):i.enable(),jQuery(this).trigger("as:action_success",i)),!0}),jQuery(document).on("ajax:complete","a.as_action",function(){var e=ActiveScaffold.ActionLink.get(jQuery(this));return e&&e.loading_indicator&&e.loading_indicator.css("visibility","hidden"),!0}),jQuery(document).on("ajax:error","a.as_action",function(e,t){var i=ActiveScaffold.ActionLink.get(jQuery(this));return i&&(ActiveScaffold.report_500_response(i.scaffold_id(),t),i.enable()),!0}),jQuery(document).on("ajax:before","a.as_cancel",function(){var e=jQuery(this),t=ActiveScaffold.find_action_link(e);if(t){var i=e.attr("href"),a=t.tag.data("cancel-refresh")||e.data("refresh");if(!a||!i)return t.close(),!1}return!0}),jQuery(document).on("ajax:success","a.as_cancel",function(e,t){var i=ActiveScaffold.find_action_link(jQuery(this));return i&&(i.position?i.close():t.evalResponse()),!0}),jQuery(document).on("ajax:error","a.as_cancel",function(e,t){var i=ActiveScaffold.find_action_link(jQuery(this));return i&&ActiveScaffold.report_500_response(i.scaffold_id(),t),!0}),jQuery(document).on("ajax:before","a.as_sort",function(){var e=jQuery(this),t=e.data("page-history");return t&&addActiveScaffoldPageToHistory(e.attr("href"),t),e.closest("th").addClass("loading"),!0}),jQuery(document).on("ajax:error","a.as_sort",function(e,t){var i=jQuery(this).closest(".active-scaffold");return ActiveScaffold.report_500_response(i,t),!0}),jQuery(document).on("mouseenter mouseleave","td.in_place_editor_field",function(e){var t=jQuery(this),i=t.find("span.in_place_editor_field");return"mouseenter"==e.type&&(t.hasClass("empty")||"undefined"==typeof i.data("editInPlace"))&&t.find("span").addClass("hover"),"mouseleave"==e.type&&(t.hasClass("empty")||"undefined"==typeof i.data("editInPlace"))&&t.find("span").removeClass("hover"),!0}),jQuery(document).on("click","td.in_place_editor_field, th.as_marked-column_heading",function(){var e=jQuery(this).find("span.in_place_editor_field");e.data("addEmptyOnCancel",jQuery(this).hasClass("empty")),jQuery(this).removeClass("empty"),e.data("editInPlace")?e.trigger("click.editInPlace"):ActiveScaffold.in_place_editor_field_clicked(e)}),jQuery(document).on("ajax:before","a.as_paginate",function(){var e=jQuery(this),t=e.data("page-history");return t&&addActiveScaffoldPageToHistory(e.attr("href"),t),e.prevAll("img.loading-indicator").css("visibility","visible"),!0}),jQuery(document).on("ajax:error","a.as_paginate",function(e,t){var i=jQuery(this).closest(".active-scaffold");return ActiveScaffold.report_500_response(i,t),!0}),jQuery(document).on("ajax:complete","a.as_paginate",function(){return jQuery(this).prevAll("img.loading-indicator").css("visibility","hidden"),!0}),jQuery(document).on("ajax:before","a.as_add_existing, a.as_replace_existing",function(){var e=jQuery(this).prev();e.is(":input")||(e=e.find(":input"));var t=e.val();return t?(jQuery(this).data("href")||jQuery(this).data("href",jQuery(this).attr("href")),jQuery(this).attr("href",jQuery(this).data("href").replace("--ID--",t)),!0):!1}),jQuery(document).on("change","input.update_form:not(.recordselect), textarea.update_form, select.update_form",function(){var e=jQuery(this),t=e.is("input:checkbox:not(:checked)")?null:e.val();return ActiveScaffold.update_column(e,e.data("update_url"),e.data("update_send_form"),e.attr("id"),t),!0}),jQuery(document).on("recordselect:change","input.recordselect.update_form",function(e,t){var i=jQuery(this);return ActiveScaffold.update_column(i,i.data("update_url"),i.data("update_send_form"),i.attr("id"),t),!0}),jQuery(document).on("change","select.as_search_range_option",function(){var e=jQuery(this);return ActiveScaffold["BETWEEN"==e.val()?"show":"hide"](e.closest("dd").find(".as_search_range_between")),ActiveScaffold["null"==e.val()||"not_null"==e.val()?"hide":"show"](e.attr("id").replace(/_opt/,"_numeric")),!0}),jQuery(document).on("change","select.as_search_date_time_option",function(){var e=jQuery(this);return ActiveScaffold["PAST"!=e.val()&&"FUTURE"!=e.val()&&"RANGE"!=e.val()?"show":"hide"](e.attr("id").replace(/_opt/,"_numeric")),ActiveScaffold["PAST"==e.val()||"FUTURE"==e.val()?"show":"hide"](e.attr("id").replace(/_opt/,"_trend")),ActiveScaffold["RANGE"==e.val()?"show":"hide"](e.attr("id").replace(/_opt/,"_range")),!0}),jQuery(document).on("change","select.as_update_date_operator",function(){return ActiveScaffold["REPLACE"==jQuery(this).val()?"show":"hide"](jQuery(this).next()),ActiveScaffold["REPLACE"==jQuery(this).val()?"hide":"show"](jQuery(this).next().next()),!0}),jQuery(document).on("click",".active-scaffold .sub-form a.destroy",function(t){t.preventDefault(),ActiveScaffold.delete_subform_record(e(this).data("delete-id"))}),jQuery(document).on("click","a[data-popup]",function(e){window.open(jQuery(this).attr("href")),e.preventDefault()}),jQuery(document).on("click",".hover_click",function(){var e=jQuery(this),t=e.children("ul").first();return t.is(":visible")?e.find("ul").hide():t.show(),!1}),jQuery(document).on("click",".hover_click a.as_action",function(){var e=jQuery(this).closest(".hover_click");return e&&e.find("ul").hide(),!0}),jQuery(document).on("click",".message a.close",function(e){ActiveScaffold.hide(jQuery(this).closest(".message")),e.preventDefault()})}),function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function a(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var n=new this;e=!1;for(var o in i)n[o]="function"==typeof i[o]&&"function"==typeof r[o]&&t.test(i[o])?function(e,t){return function(){var i=this._super;this._super=r[e];var a=t.apply(this,arguments);return this._super=i,a}}(o,i[o]):i[o];return a.prototype=n,a.constructor=a,a.extend=arguments.callee,a}}(),"undefined"==typeof jQuery.fn.delayedObserver&&function(){function e(e){i=a[e],i.timer||(i.timer=setTimeout(function(){i.timer=null,i.callback(i.obj.val(),i.obj)},1e3*i.delay),i.oldVal=i.obj.val())}function t(e){var t=e.keyCode;return e.metaKey||t>=9&&16>=t||t>=27&&40>=t||t>=91&&93>=t||t>=112&&145>=t}var i,a=[];jQuery.fn.extend({delayedObserver:function(r,n){$this=jQuery(this),a.push({obj:$this,timer:null,delay:r,oldVal:$this.val(),callback:n}),stackPos=a.length-1,$this.keyup(function(r){t(r)||(i=a[stackPos],i.obj.val()!=i.obj.oldVal&&e(stackPos))})}})}(jQuery);var ActiveScaffold={last_focus:null,records_for:function(e){return"string"==typeof e&&(e="#"+e),jQuery(e).children(".record")},stripe:function(e){var t=!1,i=this.records_for(e);i.each(function(e,i){row=jQuery(i),"SCRIPT"==i.tagName||row.hasClass("create")||row.hasClass("update")||row.hasClass("inline-adapter")||row.hasClass("active-scaffold-calculations")||(t?row.addClass("even-record"):row.removeClass("even-record"),t=!t)})},hide_empty_message:function(e){0!=this.records_for(e).length&&jQuery(e).parent().find("tbody.messages p.empty-message").hide()},reload_if_empty:function(e,t){0==this.records_for(e).length&&this.reload(t)},reload:function(e){jQuery.getScript(e)},removeSortClasses:function(e){"string"==typeof e&&(e="#"+e),e=jQuery(e),e.find("td.sorted").each(function(e){e.removeClass("sorted")}),e.find("th.sorted").each(function(e){e.removeClass("sorted"),e.removeClass("asc"),e.removeClass("desc")})},decrement_record_count:function(e){"string"==typeof e&&(e="#"+e),e=jQuery(e),count=e.find("span.active-scaffold-records").last(),count&&count.html(parseInt(count.html(),10)-1)},increment_record_count:function(e){"string"==typeof e&&(e="#"+e),e=jQuery(e),count=e.find("span.active-scaffold-records").last(),count&&count.html(parseInt(count.html(),10)+1)},update_row:function(e,t){var i=!1,a=null;"string"==typeof e&&(e="#"+e),e=jQuery(e),e.hasClass("even-record")&&(i=!0),a=this.replace(e,t),i===!0&&a.addClass("even-record"),ActiveScaffold.highlight(a)},replace:function(e,t){"string"==typeof e&&(e="#"+e),e=jQuery(e);var i="string"==typeof t?jQuery.parseHTML(t.trim(),!0):t;return i=jQuery(i),e.replaceWith(i),i.trigger("as:element_updated"),i},replace_html:function(e,t){return"string"==typeof e&&(e="#"+e),e=jQuery(e),e.html(t),e.trigger("as:element_updated"),e},remove:function(e,t){"string"==typeof e&&(e="#"+e),jQuery(e).remove(),t&&t()},update_inplace_edit:function(e,t,i){"string"==typeof e&&(e="#"+e),this.replace_html(jQuery(e),t),jQuery(e).closest("td")[i?"addClass":"removeClass"]("empty")},hide:function(e){"string"==typeof e&&(e="#"+e),jQuery(e).hide()},show:function(e){"string"==typeof e&&(e="#"+e),jQuery(e).show()},reset_form:function(e){"string"==typeof e&&(e="#"+e),jQuery(e).get(0).reset()},disable_form:function(e,t){"string"==typeof e&&(e="#"+e),e=jQuery(e);var i=jQuery("#"+e.attr("id").replace(/-form$/,"-loading-indicator"));!t&&i&&i.css("visibility","visible"),jQuery("input[type=submit]",e).attr("disabled","disabled"),jQuery("input:enabled,select:enabled,textarea:enabled",e).attr("disabled","disabled").attr("data-remove-disabled",!0)},enable_form:function(e,t){"string"==typeof e&&(e="#"+e),e=jQuery(e);var i=jQuery("#"+e.attr("id").replace(/-form$/,"-loading-indicator"));!t&&i&&i.css("visibility","hidden"),jQuery("input[type=submit]",e).removeAttr("disabled"),jQuery("input[data-remove-disabled],select[data-remove-disabled],textarea[data-remove-disabled]",e).removeAttr("disabled data-remove-disabled")},focus_first_element_of_form:function(e){"string"==typeof e&&(e="#"+e),jQuery(e+":first *:input[type!=hidden]:first").focus()},create_record_row:function(e,t,i){if("string"==typeof e&&(e="#"+e),tbody=jQuery(e).find("tbody.records").first(),"top"==i.insert_at){tbody.prepend(t);var a=tbody.children("tr.record:first-child")}else if("bottom"==i.insert_at){var r=tbody.children("tr.record, tr.inline-adapter"),a=null;a=r.length>0?r.last().after(t).next():tbody.append(t).children().last()}else if("object"==typeof i.insert_at){var n,o,s,c;i.insert_at.after?(n="after",o="next"):(n="before",o="prev"),(c=i.insert_at[n])&&(s=tbody.children("#"+c)),s&&s.length&&(a=s[n](t)[o]())}this.stripe(tbody),this.hide_empty_message(tbody),this.increment_record_count(tbody.closest("div.active-scaffold")),this.highlight(a)},create_record_row_from_url:function(e,t,i){jQuery.get(t,function(e){ActiveScaffold.create_record_row(action_link.scaffold(),e,i),action_link.close()})},delete_record_row:function(e,t){"string"==typeof e&&(e="#"+e),e=jQuery(e);var i=e.closest("tbody.records");e.find("a.disabled").each(function(){var e=ActiveScaffold.ActionLink.get(this);e&&e.close()}),ActiveScaffold.remove(e,function(){ActiveScaffold.stripe(i),ActiveScaffold.decrement_record_count(i.closest("div.active-scaffold")),ActiveScaffold.reload_if_empty(i,t)})},delete_subform_record:function(e){"string"==typeof e&&(e="#"+e),e=jQuery(e).closest(".sub-form-record"),this.remove(e)},report_500_response:function(e){var t=jQuery(e).find("td.messages-container p.server-error").first();t.is(":visible")?ActiveScaffold.highlight(t):t.show(),ActiveScaffold.scroll_to(t,"checkInViewport"==ActiveScaffold.config.scroll_on_close)},find_action_link:function(e){return"string"==typeof e&&(e="#"+e),e=jQuery(e),ActiveScaffold.ActionLink.get(e.is(".actions a")?e:e.closest(".as_adapter"))},display_dynamic_action_group:function(e,t){"string"==typeof e&&(e=jQuery("#"+e)),e.next("ul").remove(),e.closest("td").addClass("action_group dyn"),e.after(t)},scroll_to:function(e,t){"undefined"==typeof t&&(t=!0),"string"==typeof e&&(e="#"+e);var i=jQuery(e).offset().top;if(t){var a=jQuery(window).scrollTop(),r=a+jQuery(window).height();if(r>=i+jQuery(e).height()&&i>=a)return}jQuery(document).scrollTop(i)},process_checkbox_inplace_edit:function(e,t){var i=e.is(":checked"),a=e.closest("td");i===!0&&(t.params+="&value=1"),jQuery.ajax({url:t.url,type:"POST",data:t.params,dataType:t.ajax_data_type,beforeSend:function(i,r){t.beforeSend&&t.beforeSend.call(e,i,r),e.attr("disabled","disabled"),a.closest("tr").find("td.actions .loading-indicator").css("visibility","visible")},complete:function(){e.removeAttr("disabled")},success:function(){a.closest("tr").find("td.actions .loading-indicator").css("visibility","hidden")}})},read_inplace_edit_heading_attributes:function(e,t){e.data("ie-cancel-text")&&(t.cancel_button='<button class="inplace_cancel">'+e.data("ie-cancel-text")+"</button>"),e.data("ie-loading-text")&&(t.loading_text=e.data("ie-loading-text")),e.data("ie-saving-text")&&(t.saving_text=e.data("ie-saving-text")),e.data("ie-save-text")&&(t.save_button='<button class="inplace_save">'+e.data("ie-save-text")+"</button>"),e.data("ie-rows")&&(t.textarea_rows=e.data("ie-rows")),e.data("ie-cols")&&(t.textarea_cols=e.data("ie-cols")),e.data("ie-size")&&(t.text_size=e.data("ie-size"))},create_inplace_editor:function(e,t){e.removeClass("hover"),e.editInPlace(t),e.trigger("click.editInPlace")},highlight:function(e){"string"==typeof e&&(e=jQuery("#"+e)),"function"==typeof e.effect&&e.effect("highlight",jQuery.extend({},ActiveScaffold.config.highlight),3e3)},create_visibility_toggle:function(e,t){"string"==typeof e&&(e="#"+e);var i=jQuery(e),a=i.prev(),r=t.default_visible===!0?t.hide_label:t.show_label;a.append(' (<a class="visibility-toggle" href="#">'+r+"</a>)"),a.children("a").click(function(e){return e.preventDefault(),i.toggle(),jQuery(this).html(i.is(":hidden")?t.show_label:t.hide_label),!1})},create_associated_record_form:function(e,t,i){"string"==typeof e&&(e="#"+e);var e=jQuery(e);if(t=jQuery(t),0==i.singular){if(!(i.id&&jQuery("#"+i.id).size()>0)){var a=e.children("tfoot");a.length?a.before(t):e.append(t),t.trigger("as:element_created")}}else{var r=jQuery("#"+e.attr("id")+" .sub-form-record");r[0]?this.replace(r[0],t):(e.prepend(t),t.trigger("as:element_created"))}},render_form_field:function(e,t,i){"string"==typeof e&&(e="#"+e);var e=jQuery(e),a=e.closest(".sub-form-record");0==a.length&&(a=e.closest("form > ol.form")),a=a.find("."+i.field_class).first(),a&&(0==i.is_subform?this.replace(a.closest("dl"),t):this.replace_html(a,t))},record_select_onselect:function(e,t,i){jQuery.ajax({url:e.split("--ID--").join(i),error:function(e){ActiveScaffold.report_500_response(t,e)}})},mark_records:function(e,t){"string"==typeof e&&(e="#"+e);var e=jQuery(e);if(t.include_checkboxes){var i=jQuery("#"+e.attr("id")+' > tr.record td.as_marked-column input[type="checkbox"]');i.prop("checked",!!t.checked),i.val(""+!t.checked)}if(t.include_mark_all){var a=e.prevAll("thead").find('th.as_marked-column_heading span input[type="checkbox"]');a.prop("checked",!!t.checked),a.val(""+!t.checked)}},in_place_editor_field_clicked:function(e){if("undefined"==typeof e.data("editInPlace")){var t={show_buttons:!0,hover_class:"hover",element_id:"editor_id",ajax_data_type:"script",delegate:{willCloseEditInPlace:function(e){e.data("addEmptyOnCancel")&&e.closest("td").addClass("empty"),e.closest("tr").find("td.actions .loading-indicator").css("visibility","visible")},didCloseEditInPlace:function(e){e.closest("tr").find("td.actions .loading-indicator").css("visibility","hidden")}},update_value:"value"},i=jQuery("meta[name=csrf-param]").first(),a=jQuery("meta[name=csrf-token]").first(),r=e.parent(),n=null;if(r.is("td")||r.is("th")||(r=e.parents("td").eq(0)),r.is("td")){var o=r.prevAll("td").length;n=r.closest(".active-scaffold").find("th:eq("+o+")")}else r.is("th")&&(n=r);var s=n.data("ie-render-url"),c=n.data("ie-mode"),d=e.data("ie-id")||"";if(ActiveScaffold.read_inplace_edit_heading_attributes(n,t),t.url=e.data("ie-url")?e.data("ie-url").replace(/__id__/,d):n.data("ie-url").replace(/__id__/,d),i&&(t.params=i.attr("content")+"="+a.attr("content")),e.closest("div.active-scaffold").data("eid")&&(t.params.length>0&&(t.params+="&"),t.params+="eid="+e.closest("div.active-scaffold").data("eid")),"clone"===c&&(t.clone_id_suffix=d,t.clone_selector="#"+n.attr("id")+" .as_inplace_pattern",t.field_type="clone"),s){var l=!1;n.data("ie-plural")&&(l=!0),t.field_type="remote",t.editor_url=s.replace(/__id__/,d),t.delegate||(t.delegate={}),t.delegate.didOpenEditInPlace=function(e){e.trigger("as:element_updated")}}var f,u;t.beforeSend=function(){switch(e.data("ie-update")){case"update_row":f=e.closest("tr").find(".actions a:not(.disabled)").addClass("disabled");break;case"update_table":var t=e.closest(".as_content");f=t.find(".actions a:not(.disabled)").addClass("disabled"),u=t.find(".as_form"),ActiveScaffold.disable_form(u)}},t.error=t.success=function(){f&&f.removeClass("disabled"),u&&ActiveScaffold.enable_form(u)},"inline_checkbox"===c?ActiveScaffold.process_checkbox_inplace_edit(e.find("input:checkbox"),t):ActiveScaffold.create_inplace_editor(e,t)}},update_column:function(e,t,i,a,r){e||(e=jQuery("#"+a));var n=e.closest("form.as_form"),o=null;if(i){var s,c=n;"row"==i&&(c=e.closest(".association-record, form")),(s=e.data("update_send_form_selector"))?o=c.find(s).serialize():i!=n?o=c.find(":input").serialize():c.serialize(),o+="&_method=&"+jQuery.param({source_id:a})}else o={value:r},o.source_id=a;jQuery.ajax({url:t,data:o,type:"post",beforeSend:function(){e.nextAll("img.loading-indicator").css("visibility","visible"),ActiveScaffold.disable_form(n)},complete:function(){e.nextAll("img.loading-indicator").css("visibility","hidden"),ActiveScaffold.enable_form(n),ActiveScaffold.last_focus&&$(ActiveScaffold.last_focus).focus().select()},error:function(t){var i=e.closest("div.active-scaffold");i&&ActiveScaffold.report_500_response(i,t)}})},draggable_lists:function(e){jQuery("ul#"+e).draggable_lists()}};String.prototype.append_params=function(e){var t=this;-1==t.indexOf("?")?t+="?":t.lastIndexOf("&")!=t.length&&(t+="&");for(var i in e)i&&(t+=i+"="+e[i]+"&");return t=t.substring(0,t.length-1)},ActiveScaffold.Actions=new Object,ActiveScaffold.Actions.Abstract=Class.extend({init:function(e,t,i,a){this.target=jQuery(t),this.loading_indicator=jQuery(i),this.options=a;var r=this;this.links=jQuery.map(e,function(e){var t=r.instantiate_link(e);return t})},instantiate_link:function(){throw"unimplemented"}}),ActiveScaffold.ActionLink={get:function(e){"string"==typeof e&&(e="#"+e);var e=jQuery(e);if(e.length>0){if(e.data(),"undefined"==typeof e.data("action_link")&&!e.hasClass("as_adapter")){var t=e.closest(".actions");if((0===t.length||t.is("td"))&&(t=e.closest("tr.record")),t.is("tr")){var i=t.find("a.as_action"),a=t.find("td.actions .loading-indicator");a.length||(a=e.parent().find(".loading-indicator")),new ActiveScaffold.Actions.Record(i,t,a)}else t&&t.is("div")&&new ActiveScaffold.Actions.Table(t.find("a.as_action"),t.closest("div.active-scaffold").find("tbody.before-header").first(),t.find(".loading-indicator").first());e=jQuery(e)}return e.data("action_link")}return null}},ActiveScaffold.ActionLink.Abstract=Class.extend({init:function(e,t,i){return this.tag=jQuery(e),this.url=this.tag.attr("href"),this.method=this.tag.data("method")||"get",this.target=t,this.loading_indicator=i,this.hide_target=!1,this.position=this.tag.data("position"),this.action=this.tag.data("action"),this.tag.data("action_link",this),this},open:function(){this.tag.click()},insert:function(){throw"unimplemented"},close:function(){var e=this;ActiveScaffold.remove(this.adapter,function(){e.enable(),e.hide_target&&e.target.show(),ActiveScaffold.config.scroll_on_close&&ActiveScaffold.scroll_to(e.target.attr("id"),"checkInViewport"==ActiveScaffold.config.scroll_on_close)})},reload:function(){this.close(),this.open()},get_new_adapter_id:function(){for(var e="adapter_",t=0;jQuery(e+t);)t++;return e+t},enable:function(){return this.tag.removeClass("disabled")},disable:function(){return this.tag.addClass("disabled")},is_disabled:function(){return this.tag.hasClass("disabled")},scaffold_id:function(){return"#"+this.tag.closest("div.active-scaffold").attr("id")},scaffold:function(){return this.tag.closest("div.active-scaffold")},update_flash_messages:function(e){message_node=jQuery(this.scaffold_id().replace(/-active-scaffold/,"-messages")),message_node&&message_node.html(e)},set_adapter:function(e){this.adapter=e,this.adapter.addClass("as_adapter"),this.adapter.data("action_link",this),this.refresh_url&&jQuery(".as_cancel",this.adapter).attr("href",this.refresh_url)},keep_open:function(){return this.tag.data("keep-open")}}),ActiveScaffold.Actions.Record=ActiveScaffold.Actions.Abstract.extend({instantiate_link:function(e){var t=new ActiveScaffold.ActionLink.Record(e,this.target,this.loading_indicator),i=this.target.data("refresh");return i&&(t.refresh_url=i),t.position&&(t.url=t.url.append_params({adapter:"_list_inline_adapter"}),t.tag.attr("href",t.url)),t.set=this,t}}),ActiveScaffold.ActionLink.Record=ActiveScaffold.ActionLink.Abstract.extend({close_previous_adapter:function(){var e=this;jQuery.each(this.set.links,function(t,i){i.url!=e.url&&i.is_disabled()&&!i.keep_open()&&i.adapter&&ActiveScaffold.remove(i.adapter,function(){i.enable()})})},insert:function(e){if(this.close_previous_adapter(),"replace"==this.position&&(this.position="after",this.hide_target=!0),"after"==this.position)this.target.after(e),this.set_adapter(this.target.next());else{if("before"!=this.position)return!1;this.target.before(e),this.set_adapter(this.target.prev())}ActiveScaffold.highlight(this.adapter.find("td"))},close:function(e){if(this._super(),e)if("string"==typeof e)ActiveScaffold.update_row(this.target,e);else if(this.refresh_url){var t=this.target;jQuery.get(this.refresh_url,function(e,i,a){ActiveScaffold.update_row(t,a.responseText)})}},enable:function(){var e=this;jQuery.each(this.set.links,function(t,i){i.url==e.url&&i.tag.removeClass("disabled")})},disable:function(){var e=this;jQuery.each(this.set.links,function(t,i){i.url==e.url&&i.tag.addClass("disabled")})},set_opened:function(){"after"==this.position?this.set_adapter(this.target.next()):"before"==this.position&&this.set_adapter(this.target.prev()),this.disable()}}),ActiveScaffold.Actions.Table=ActiveScaffold.Actions.Abstract.extend({instantiate_link:function(e){var t=new ActiveScaffold.ActionLink.Table(e,this.target,this.loading_indicator);return t.position&&(t.url=t.url.append_params({adapter:"_list_inline_adapter"}),t.tag.attr("href",t.url)),t}}),ActiveScaffold.ActionLink.Table=ActiveScaffold.ActionLink.Abstract.extend({insert:function(e){if("top"!=this.position)throw'Unknown position "'+this.position+'"';this.target.prepend(e),this.set_adapter(this.target.children().first()),ActiveScaffold.highlight(this.adapter.find("td").first().children())}});