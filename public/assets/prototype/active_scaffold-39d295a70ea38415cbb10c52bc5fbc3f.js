function addActiveScaffoldPageToHistory(e,t){if("undefined"!=typeof dhtmlHistory){var i=e.split("?"),a=new Querystring(i[1]),n=a.get("sort"),o=a.get("sort_direction"),r=a.get("page");(n||o||r)&&dhtmlHistory.add(t+":"+r+":"+n+":"+o,e)}}"undefined"==typeof Prototype&&(warning="ActiveScaffold Error: Prototype could not be found. Please make sure that your application's layout includes prototype.js (e.g. <%= javascript_include_tag :defaults %>) *before* it includes active_scaffold.js (e.g. <%= active_scaffold_includes %>).",alert(warning)),"1.6">Prototype.Version.substring(0,3)&&(warning="ActiveScaffold Error: Prototype version 1.6.x or higher is required. Please update prototype.js (rake rails:update:javascripts).",alert(warning)),Element.Methods.highlight||Element.addMethods({highlight:Prototype.emptyFunction}),document.observe("dom:loaded",function(){document.on("click",function(){$$(".action_group.dyn ul").invoke("remove")}),document.on("ajax:complete",".action_group.dyn ul a",function(){var e=event.findElement(),t=ActiveScaffold.find_action_link(e);t.loading_indicator&&t.loading_indicator.css("visibility","hidden"),$(e).up(".action_group.dyn ul").remove()}),document.on("ajax:create","form.as_form",function(e){var t=e.findElement(),i=e.findElement("form");return"INPUT"==t.nodeName.toUpperCase()&&"button"==t.readAttribute("type")||i&&"true"==i.readAttribute("data-loading")&&ActiveScaffold.disable_form(i),!0}),document.on("ajax:complete","form.as_form",function(e){var t=e.findElement("form");return t&&"true"==t.readAttribute("data-loading")?(ActiveScaffold.enable_form(t),e.stop(),!1):void 0}),document.on("ajax:failure","form.as_form",function(e){var t=e.findElement("div.active-scaffold");return t?(ActiveScaffold.report_500_response(t),e.stop(),!1):void 0}),document.on("submit","form.as_form:not([data-remote])",function(e){var t=e.findElement("form");return t&&"true"==t.readAttribute("data-loading")&&setTimeout("ActiveScaffold.disable_form('"+t.readAttribute("id")+"')",10),!0}),document.on("ajax:before","a.as_action",function(e){var t=ActiveScaffold.ActionLink.get(e.findElement());return t&&(t.is_disabled()?e.stop():(t.loading_indicator&&(t.loading_indicator.style.visibility="visible"),t.disable())),!0}),document.on("ajax:success","a.as_action",function(e){var t=ActiveScaffold.ActionLink.get(e.findElement());return t&&e.memo&&e.memo.request&&(t.position?(t.insert(e.memo.request.transport.responseText),t.hide_target&&t.target.hide()):t.enable(),e.stop()),!0}),document.on("ajax:complete","a.as_action",function(e){var t=ActiveScaffold.ActionLink.get(e.findElement());return t&&t.loading_indicator&&(t.loading_indicator.style.visibility="hidden"),!0}),document.on("ajax:failure","a.as_action",function(e){var t=ActiveScaffold.ActionLink.get(e.findElement());return t&&(ActiveScaffold.report_500_response(t.scaffold_id()),t.enable()),!0}),document.on("ajax:before","a.as_cancel",function(e){var t=e.findElement(),i=ActiveScaffold.find_action_link(t);if(i){var a=i.tag.readAttribute("data-cancel-refresh")||t.readAttribute("data-refresh");a&&i.refresh_url?e.memo.url=i.refresh_url:(!a||t.readAttribute("href").blank())&&(i.close(),e.stop())}return!0}),document.on("ajax:success","a.as_cancel",function(e){var t=ActiveScaffold.find_action_link(e.findElement());return t&&(t.position?t.close():e.memo.request.evalResponse()),!0}),document.on("ajax:failure","a.as_cancel",function(e){var t=ActiveScaffold.find_action_link(e.findElement());return t&&ActiveScaffold.report_500_response(t.scaffold_id()),!0}),document.on("ajax:before","a.as_sort",function(e){var t=e.findElement(),i=t.readAttribute("data-page-history");return i&&addActiveScaffoldPageToHistory(t.readAttribute("href"),i),t.up("th").addClassName("loading"),!0}),document.on("ajax:failure","a.as_sort",function(e){var t=e.findElement(".active-scaffold");return ActiveScaffold.report_500_response(t),!0}),document.on("mouseover","td.in_place_editor_field",function(e){e.findElement("td.in_place_editor_field").select("span").invoke("addClassName","hover")}),document.on("mouseout","td.in_place_editor_field",function(e){e.findElement("td.in_place_editor_field").select("span").invoke("removeClassName","hover")}),document.on("click","td.in_place_editor_field",function(e){var t=e.findElement("td.in_place_editor_field"),i=t.down("span.in_place_editor_field");if(t.removeClassName("empty"),"undefined"==typeof i.inplace_edit){var a={htmlResponse:!1,onEnterHover:null,onLeaveHover:null,onComplete:null,params:"",externalControl:t.down(".handle"),ajaxOptions:{method:"post"}},n=$$("meta[name=csrf-param]")[0],o=$$("meta[name=csrf-token]")[0],r=i.up(),d=null;if("td"!==r.nodeName.toLowerCase()&&"th"!==r.nodeName.toLowerCase()&&(r=i.up("td")),"td"===r.nodeName.toLowerCase()){var s="."+i.up().readAttribute("class").split(" ")[0]+"_heading";d=i.up(".active-scaffold").down(s)}else"th"===r.nodeName.toLowerCase()&&(d=r);var c=d.readAttribute("data-ie-render-url"),l=d.readAttribute("data-ie-mode"),u=i.readAttribute("data-ie-id")||"";if(ActiveScaffold.read_inplace_edit_heading_attributes(d,a),a.url=i.readAttribute("data-ie-url")?i.readAttribute("data-ie-url"):d.readAttribute("data-ie-url"),a.url=a.url.sub("__id__",u),n&&(a.params=n.readAttribute("content")+"="+o.readAttribute("content")),i.up("div.active-scaffold").readAttribute("data-eid")&&(a.params.length>0&&(a.params+="&"),a.params+="eid="+i.up("div.active-scaffold").readAttribute("data-eid")),"clone"===l&&(a.nodeIdSuffix=u,a.inplacePatternSelector="#"+d.readAttribute("id")+" .as_inplace_pattern",a.onFormCustomization=new Function("element","form","element.clonePatternField();")),c){var f=!1;d.readAttribute("data-ie-plural")&&(f=!0),a.onFormCustomization=new Function("element","form","element.setFieldFromAjax('"+c.sub("__id__",u)+"', {plural: "+f+"});")}"inline_checkbox"===l?ActiveScaffold.process_checkbox_inplace_edit(i.down('input[type="checkbox"]'),a):ActiveScaffold.create_inplace_editor(i,a)}return!0}),document.on("ajax:before","a.as_paginate",function(e){var t=e.findElement(),i=t.up().down("img.loading-indicator"),a=t.readAttribute("data-page-history");return a&&addActiveScaffoldPageToHistory(t.readAttribute("href"),a),i&&(i.style.visibility="visible"),!0}),document.on("ajax:failure","a.as_paginate",function(e){var t=e.findElement(".active-scaffold");return ActiveScaffold.report_500_response(t),!0}),document.on("ajax:complete","a.as_paginate",function(e){var t=e.findElement(),i=t.up().down("img.loading-indicator");return i&&(i.style.visibility="hidden"),!0}),document.on("ajax:before","a.as_add_existing, a.as_replace_existing",function(e){var t=e.findElement(),i=t.previous();i.match("input,select")||(i=i.down("input,select"));var a=i.getValue();return a?(e.memo.url=t.readAttribute("href").sub("--ID--",a),!0):!1}),document.on("change","input.update_form, textarea.update_form, select.update_form",function(e){var t=e.findElement();return ActiveScaffold.update_column(t,t.readAttribute("data-update_url"),t.hasAttribute("data-update_send_form"),t.readAttribute("id"),t.getValue()),!0}),document.on("recordselect:change","input.recordselect.update_form",function(e){var t=e.findElement();return ActiveScaffold.update_column(t,t.readAttribute("data-update_url"),t.hasAttribute("data-update_send_form"),t.readAttribute("id"),t.memo.id),!0}),document.on("change","select.as_search_range_option",function(e){var t=e.findElement();return Element["BETWEEN"==t.value?"show":"hide"](t.readAttribute("id").sub("_opt","_between")),Element["null"==t.value||"not_null"==t.value?"hide":"show"](t.readAttribute("id").sub("_opt","_numeric")),!0}),document.on("change","select.as_search_date_time_option",function(e){var t=e.findElement();return Element["PAST"!=t.value&&"FUTURE"!=t.value&&"RANGE"!=t.value?"show":"hide"](t.readAttribute("id").sub("_opt","_numeric")),Element["PAST"==t.value||"FUTURE"==t.value?"show":"hide"](t.readAttribute("id").sub("_opt","_trend")),Element["RANGE"==t.value?"show":"hide"](t.readAttribute("id").sub("_opt","_range")),!0}),document.on("change","select.as_update_date_operator",function(e){var t=e.findElement();return Element["REPLACE"==t.value?"show":"hide"](t.next()),Element["REPLACE"==t.value?"show":"hide"](t.next().next()),Element["REPLACE"==t.value?"hide":"show"](t.next("span")),!0}),document.on("click","a[data-popup]",function(e,t){e.stopped||(window.open($(t).href),e.stop())}),document.on("click",".hover_click",function(e,t){var i=t.down("ul");return i.style.display="none"===i.getStyle("display")?"block":"none",!0}),document.on("click",".hover_click a.as_action",function(e,t){var t=t.up(".hover_click").down("ul");return t&&(t.style.display="none"),!0}),document.on("click",".messages a.close",function(e,t){ActiveScaffold.hide(t.up(".message")),e.stop()})});var ActiveScaffold={records_for:function(e){for(var t=[],i=$(e).down(".record");i;)t.push(i),i=i.next(".record");return t},stripe:function(e){for(var t=!1,i=this.records_for(e),a=0;i.length>a;a++){var n=i[a];"SCRIPT"==n.tagName||n.hasClassName("create")||n.hasClassName("update")||n.hasClassName("inline-adapter")||n.hasClassName("active-scaffold-calculations")||(t?n.addClassName("even-record"):n.removeClassName("even-record"),t=!t)}},hide_empty_message:function(e){if(0!=this.records_for(e).length){var t=$(e).up().select("tbody.messages p.empty-message");t.invoke("hide")}},reload_if_empty:function(e,t){0==this.records_for(e).length&&this.reload(t)},reload:function(e){new Ajax.Request(e,{method:"get",asynchronous:!0,evalScripts:!0})},removeSortClasses:function(e){e=$(e),e.select("td.sorted").each(function(e){e.removeClassName("sorted")}),e.select("th.sorted").each(function(e){e.removeClassName("sorted"),e.removeClassName("asc"),e.removeClassName("desc")})},decrement_record_count:function(e){e=$(e),count=e.select("span.active-scaffold-records").last(),count&&count.update(parseInt(count.innerHTML,10)-1)},increment_record_count:function(e){e=$(e),count=e.select("span.active-scaffold-records").last(),count&&count.update(parseInt(count.innerHTML,10)+1)},update_row:function(e,t){e=$(e);var i=this.replace(e,t);e.hasClassName("even-record")&&i.addClassName("even-record"),ActiveScaffold.highlight(i)},replace:function(e,t){return e=$(e),Element.replace(e,t),e=$(e.readAttribute("id"))},replace_html:function(e,t){return e=$(e),e.update(t),e},remove:function(e,t){$(e).remove(),t&&t()},update_inplace_edit:function(e,t,i){this.replace_html(e,t),i&&$(e).up("td").addClassName("empty")},hide:function(e){$(e).hide()},show:function(e){$(e).show()},reset_form:function(e){$(e).reset()},disable_form:function(e){e=$(e);var t=$(e.readAttribute("id").sub("-form","-loading-indicator"));t&&(t.style.visibility="visible"),e.disable()},enable_form:function(e){e=$(e);var t=$(e.readAttribute("id").sub("-form","-loading-indicator"));t&&(t.style.visibility="hidden"),e.enable()},focus_first_element_of_form:function(e){Form.focusFirstElement(e)},create_record_row:function(e,t,i){tbody=$(e).down("tbody.records");var a=null;if("top"==i.insert_at)tbody.insert({top:t}),a=tbody.firstDescendant();else if("bottom"==i.insert_at){var n=tbody.childElements().reverse().detect(function(e){return e.hasClassName("record")||e.hasClassName("inline-adapter")});n?n.insert({after:t}):tbody.insert({bottom:t}),a=Selector.findChildElements(tbody,["tr.record"]).last()}else if("object"==typeof i.insert_at){var o,r,d,s;i.insert_at.after?(o="after",r="next"):(o="before",r="previous"),(s=i.insert_at[o])&&(d=$(s)),d&&(d.insert({insert_method:t}),a=d[r]())}this.stripe(tbody),this.hide_empty_message(tbody),this.increment_record_count(tbody.up("div.active-scaffold")),ActiveScaffold.highlight(a)},create_record_row_from_url:function(e,t,i){new Ajax.Request(t,{method:"get",onComplete:function(){ActiveScaffold.create_record_row(e.scaffold(),row,i),e.close()}})},delete_record_row:function(e,t){e=$(e);var i=e.up("tbody.records"),a=e.down("td.actions a.disabled");if(a){var n=ActiveScaffold.ActionLink.get(a);n&&n.close_previous_adapter()}ActiveScaffold.remove(e,function(){i=$(i),ActiveScaffold.stripe(i),ActiveScaffold.decrement_record_count(i.up("div.active-scaffold")),ActiveScaffold.reload_if_empty(i,t)})},delete_subform_record:function(e){var t=$(e).previous();t.hasClassName("association-record-errors")&&this.remove(t);var i=$(e).next();for(this.remove(e);i&&i.hasClassName("associated-record");)e=i,i=$(e).next(),this.remove(e)},report_500_response:function(e){var t=$(e).down("td.messages-container p.server-error");t.visible()?ActiveScaffold.highlight(t):t.show()},find_action_link:function(e){return e=$(e),ActiveScaffold.ActionLink.get(e.match(".actions a")?e:e.up(".as_adapter"))},display_dynamic_action_group:function(e,t){e=$(e),e.next("ul").remove(),e.up("td").addClassName("action_group dyn"),e.insert({after:t})},scroll_to:function(e,t){"undefined"==typeof t&&(t=!0);var i=$(e).viewportOffset().top;if(t){var a=document.viewport.getScrollOffsets().top,n=a+document.viewport.getHeight();if(n>=i+$(e).getHeight()&&i>=a)return}$(e).scrollTo()},process_checkbox_inplace_edit:function(e,t){var i=e.readAttribute("checked");"checked"!==i&&(t.params+="&value=1"),new Ajax.Request(t.url,{method:"post",parameters:t.params,onCreate:function(){e.disable()},onComplete:function(){e.enable()}})},read_inplace_edit_heading_attributes:function(e,t){e.readAttribute("data-ie-cancel-text")&&(t.cancelText=e.readAttribute("data-ie-cancel-text")),e.readAttribute("data-ie-loading-text")&&(t.loadingText=e.readAttribute("data-ie-loading-text")),e.readAttribute("data-ie-saving-text")&&(t.savingText=e.readAttribute("data-ie-saving-text")),e.readAttribute("data-ie-save-text")&&(t.okText=e.readAttribute("data-ie-save-text")),e.readAttribute("data-ie-rows")&&(t.rows=column-heading.readAttribute("data-ie-rows")),e.readAttribute("data-ie-cols")&&(t.cols=column-heading.readAttribute("data-ie-cols")),e.readAttribute("data-ie-size")&&(t.size=column-heading.readAttribute("data-ie-size"))},create_inplace_editor:function(e,t){t.params.length>0&&(t.callback=new Function("form","return Form.serialize(form) + '&"+t.params+"';")),e.removeClassName("hover"),e.inplace_edit=new ActiveScaffold.InPlaceEditor(e.readAttribute("id"),t.url,t),e.inplace_edit.enterEditMode()},create_visibility_toggle:function(e,t){var i=$(e),a=i.previous(),n=t.default_visible===!0?t.hide_label:t.show_label;a.insert(' (<a class="visibility-toggle" href="#">'+n+"</a>)"),a.firstDescendant().observe("click",function(e){var a=e.element();return e.stop(),i.toggle(),a.innerHTML="none"==i.style.display?t.show_label:t.hide_label,!1})},create_associated_record_form:function(e,t,i){var e=$(e);if(0==i.singular)i.id&&$(i.id)||e.insert(t);else{var a=$$("#"+e.readAttribute("id")+" .association-record");a[0]?this.replace(a[0],t):e.insert({top:t})}},render_form_field:function(e,t,i){var e=$(e),a=e.up(".association-record");"undefined"==typeof a&&(a=e.up("ol.form")),a=a.down("."+i.field_class),a&&(0==i.is_subform?this.replace(a.up("dl"),t):this.replace_html(a,t))},record_select_onselect:function(e,t,i){new Ajax.Request(e.sub("--ID--",i),{asynchronous:!0,evalScripts:!0,onFailure:function(){ActiveScaffold.report_500_response(t.to_json)}})},mark_records:function(e,t){var e=$(e);if(t.include_checkboxes){var i=$$("#"+e.readAttribute("id")+' > tr.record td.marked-column input[type="checkbox"]');i.each(function(e){t.checked?e.writeAttribute({checked:"checked"}):e.removeAttribute("checked"),e.writeAttribute("value",""+!t.checked)})}if(t.include_mark_all){var a=e.previous("thead").down('th.marked-column_heading span input[type="checkbox"]');t.checked?a.writeAttribute({checked:"checked"}):a.removeAttribute("checked"),a.writeAttribute("value",""+!t.checked)}},update_column:function(e,t,i,a,n){e||(e=$(a));var o=e.up("form.as_form"),r=null;if(i){var d,s=o;"row"==i&&(s=e.up(".association-record, form")),r=(d=e.readAttribute("data-update_send_form_selector"))?Form.serializeElements(s.getElementsBySelector(d),!0):s!=o?Form.serializeElements(s.getElementsBySelector("input, textarea, select"),!0):o.serialize(!0),r._method=""}else r={value:n};r.source_id=a,new Ajax.Request(t,{method:"post",parameters:r,onLoading:function(){e.next("img.loading-indicator").style.visibility="visible",o.disable()},onComplete:function(){e.next("img.loading-indicator").style.visibility="hidden",o.enable()},onFailure:function(){var e=event.findElement("div.active-scaffold");e&&ActiveScaffold.report_500_response(e)}})},draggable_lists:function(e){new DraggableLists(e)},highlight:function(e){e=$(e),"function"==typeof e.highlight&&e.highlight(Object.extend({duration:3},ActiveScaffold.config.highlight))}};Element.replace=function(e,t){if(e=$(e),e.outerHTML)try{e.outerHTML=t.stripScripts()}catch(i){var a=e.tagName;if("TBODY"!=a&&"TR"!=a&&"TD"!=a)throw i;var n=document.createElement("div");n.innerHTML='<table id="tempTable" style="display: none">'+t.stripScripts()+"</table>",e.parentNode.replaceChild(n.getElementsByTagName(a).item(0),e)}else{var o=e.ownerDocument.createRange();o.selectNodeContents(e.parentNode),e.parentNode.replaceChild(o.createContextualFragment(t.stripScripts()),e)}return setTimeout(function(){t.evalScripts()},10),e},Object.extend(String.prototype,{append_params:function(e){return url=this,-1==url.indexOf("?")?url+="?":url.lastIndexOf("&")!=url.length&&(url+="&"),url+=$H(e).collect(function(e){return e.key+"="+e.value}).join("&")}}),Element.Methods.Simulated={hasAttribute:function(e,t){var i=Element._attributeTranslations;t=i.names&&i.names[t]||t;try{return $(e).getAttributeNode(t).specified}catch(a){return!1}}},ActiveScaffold.Actions=new Object,ActiveScaffold.Actions.Abstract=Class.create({initialize:function(e,t,i,a){this.target=$(t),this.loading_indicator=$(i),this.options=a,this.links=e.collect(function(e){return this.instantiate_link(e)}.bind(this))},instantiate_link:function(){throw"unimplemented"}}),ActiveScaffold.ActionLink={get:function(e){var e=$(e);if("undefined"==typeof e.retrieve("action_link")&&!e.hasClassName("as_adapter")){var t=e.up(".actions");if("undefined"==typeof t&&(t=e.up()),t&&"TD"==t.nodeName.toUpperCase()){t=t.up("tr.record");var i=t.down("td.actions .loading-indicator");i||(i=e.parent().find(".loading-indicator")),new ActiveScaffold.Actions.Record(t.select("a.as_action"),t,i)}else t&&"DIV"==t.nodeName.toUpperCase()&&new ActiveScaffold.Actions.Table(t.select("a.as_action"),t.up("div.active-scaffold").down("tbody.before-header"),t.down(".loading-indicator"));e=$(e)}return e.retrieve("action_link")}},ActiveScaffold.ActionLink.Abstract=Class.create({initialize:function(e,t,i){this.tag=$(e),this.url=this.tag.href,this.method=this.tag.readAttribute("data-method")||"get",this.target=t,this.loading_indicator=i,this.hide_target=!1,this.position=this.tag.readAttribute("data-position"),this.tag.store("action_link",this)},open:function(){this.tag.click()},insert:function(){throw"unimplemented"},close:function(){var e=this;ActiveScaffold.remove(this.adapter,function(){e.enable(),e.hide_target&&e.target.show(),ActiveScaffold.config.scroll_on_close&&ActiveScaffold.scroll_to(e.target.id,"checkInViewport"==ActiveScaffold.config.scroll_on_close)})},reload:function(){this.close(),this.open()},get_new_adapter_id:function(){for(var e="adapter_",t=0;$(e+t);)t++;return e+t},enable:function(){return this.tag.removeClassName("disabled")},disable:function(){return this.tag.addClassName("disabled")},is_disabled:function(){return this.tag.hasClassName("disabled")},scaffold_id:function(){return this.tag.up("div.active-scaffold").readAttribute("id")},scaffold:function(){return this.tag.up("div.active-scaffold")},update_flash_messages:function(e){message_node=$(this.scaffold_id().sub("-active-scaffold","-messages")),message_node&&message_node.update(e)},set_adapter:function(e){this.adapter=e,this.adapter.addClassName("as_adapter"),this.adapter.store("action_link",this)},keep_open:function(){return!this.tag.readAttribute("data-keep-open").blank()}}),ActiveScaffold.Actions.Record=Class.create(ActiveScaffold.Actions.Abstract,{instantiate_link:function(e){var t=new ActiveScaffold.ActionLink.Record(e,this.target,this.loading_indicator);return this.target.hasAttribute("data-refresh")&&!this.target.readAttribute("data-refresh").blank()&&(t.refresh_url=this.target.readAttribute("data-refresh")),t.position&&(t.url=t.url.append_params({adapter:"_list_inline_adapter"}),t.tag.href=t.url),t.set=this,t}}),ActiveScaffold.ActionLink.Record=Class.create(ActiveScaffold.ActionLink.Abstract,{close_previous_adapter:function(){this.set.links.each(function(e){e.url!=this.url&&e.is_disabled()&&!e.keep_open()&&e.adapter&&ActiveScaffold.remove(e.adapter,function(){e.enable()})}.bind(this))},insert:function(e){if(this.close_previous_adapter(),"replace"==this.position&&(this.position="after",this.hide_target=!0),"after"==this.position)this.target.insert({after:e}),this.set_adapter(this.target.next());else{if("before"!=this.position)return!1;this.target.insert({before:e}),this.set_adapter(this.target.previous())}ActiveScaffold.highlight(this.adapter.down("td").down())},close:function($super,e){if($super(),e)if("string"==typeof e)ActiveScaffold.update_row(this.target,e);else if(this.refresh_url){var t=this.target;new Ajax.Request(this.refresh_url,{method:"get",onComplete:function(e){ActiveScaffold.update_row(t,e.responseText)}})}},enable:function(){this.set.links.each(function(e){e.url==this.url&&e.tag.removeClassName("disabled")}.bind(this))},disable:function(){this.set.links.each(function(e){e.url==this.url&&e.tag.addClassName("disabled")}.bind(this))},set_opened:function(){"after"==this.position?this.set_adapter(this.target.next()):"before"==this.position&&this.set_adapter(this.target.previous()),this.disable()}}),ActiveScaffold.Actions.Table=Class.create(ActiveScaffold.Actions.Abstract,{instantiate_link:function(e){var t=new ActiveScaffold.ActionLink.Table(e,this.target,this.loading_indicator);return t.position&&(t.url=t.url.append_params({adapter:"_list_inline_adapter"}),t.tag.href=t.url),t}}),ActiveScaffold.ActionLink.Table=Class.create(ActiveScaffold.ActionLink.Abstract,{insert:function(e){if("top"!=this.position)throw'Unknown position "'+this.position+'"';this.target.insert({top:e}),this.set_adapter(this.target.immediateDescendants().first()),ActiveScaffold.highlight(this.adapter.down("td").down())}}),Ajax.InPlaceEditor&&(ActiveScaffold.InPlaceEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,e,t,i){$super(e,t,i),"transparent"==this._originalBackground&&(this._originalBackground=null)},setFieldFromAjax:function(e,t){var i=this;$(i._controls.editor).remove(),new Ajax.Request(e,{method:"get",onComplete:function(e){if(i._form.insert({top:e.responseText}),t.plural)i._form.getElements().each(function(e){"submit"!=e.type&&"image"!=e.type&&(e.name=i.options.paramName+"[]",e.className="editor_field")});else{var a=i._form.findFirstElement();a.name=i.options.paramName,a.className="editor_field",i.options.submitOnBlur&&(a.onblur=i._boundSubmitHandler),i._controls.editor=a}}})},clonePatternField:function(){var e=this.getPatternNodes(this.options.inplacePatternSelector);if(null==e.editNode)return alert("did not find any matching node for "+this.options.editFieldSelector),void 0;var t=e.editNode.cloneNode(!0);t.id.length>0&&(t.id+=this.options.nodeIdSuffix),t.name=this.options.paramName,t.className="editor_field",this.setValue(t,this._controls.editor.value),this.options.submitOnBlur&&(t.onblur=this._boundSubmitHandler),$(this._controls.editor).remove(),this._controls.editor=t,this._form.appendChild(this._controls.editor),$A(e.additionalNodes).each(function(e){var t=e.cloneNode(!0);t.id.length>0&&(t.id=t.id+this.options.nodeIdSuffix),this._form.appendChild(t)}.bind(this))},getPatternNodes:function(e){var t={editNode:null,additionalNodes:[]},i=$$(e),a=i.first();return"undefined"!=typeof a&&(-1!==a.className.indexOf("as_inplace_pattern")&&(i=a.childElements()),t.editNode=i.first(),i.shift(),t.additionalNodes=i),t},setValue:function(e,t){var i="setValueFor"+e.nodeName.toLowerCase();"function"==typeof this[i]?this[i](e,t):e.value=t},setValueForselect:function(e,t){for(var i=e.options.length,a=0;i>a&&e.options[a].text!=t;)a++;i>a&&(e.value=e.options[a].value)}}));